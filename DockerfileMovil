FROM openjdk:19-sdk

ENV USER="sipac"
ENV LANG en_US.UTF-8
ENV FLUTTER_HOME "/home/$USER/flutter"
ENV FLUTTER_URL "https://storage.googleapis.com/flutter_infra_release/releases/stable/linux/flutter_linux_2.10.5-stable.tar.xz"

RUN apt-get update;  \
    apt-get install -y --no-install-recommends \
              curl \
              git \
              lib32stdc++6 \
              libglu1-mesa \
              wget \
              ssh \
              unzip \
              ca-certificates \
              xz-utils \
              lcov \
              git-crypt; \
    rm -rf /var/lib/apt/lists/*

RUN useradd -ms /bin/bash $USER
USER $USER
WORKDIR /home/$USER

#TODO: terminar de ver bien lo del SDK de android
# android sdk
#RUN mkdir -p /home/$USER/Android/Sdk \
#  && mkdir -p /home/$USER/.android \
#  && touch /home/$USER/.android/repositories.cfg \
#  && curl -o android_tools.zip https://dl.google.com/android/repository/platform-tools-latest-linux.zip \
#  && unzip -qq -d "$ANDROID_SDK_ROOT" android_tools.zip \
#  && rm android_tools.zip \
#  && mkdir -p $ANDROID_SDK_ROOT/cmdline-tools/tools \
#  && mv $ANDROID_SDK_ROOT/cmdline-tools/bin $ANDROID_SDK_ROOT/cmdline-tools/tools \
#  && mv $ANDROID_SDK_ROOT/cmdline-tools/lib $ANDROID_SDK_ROOT/cmdline-tools/tools \
#  && yes "y" | sdkmanager "build-tools;$ANDROID_BUILD_TOOLS_VERSION" \
#  && yes "y" | sdkmanager "platforms;android-$ANDROID_VERSION" \
#  && yes "y" | sdkmanager "platform-tools" \
#  && yes "y" | sdkmanager "emulator" \
#  && yes "y" | sdkmanager "system-images;android-$ANDROID_VERSION;google_apis_playstore;$ANDROID_ARCHITECTURE"

# flutter
RUN mkdir -p $FLUTTER_HOME; \
    curl -L ${FLUTTER_URL} -o /tmp/flutter.tar.xz --progress-bar; \
    tar xf /tmp/flutter.tar.xz -C /tmp; \
    mv /tmp/flutter/ -T ${FLUTTER_HOME}; \
    rm -rf /tmp/flutter.tar.xz

ENV PATH=$PATH:$FLUTTER_HOME/bin
ENV PATH=$PATH:$FLUTTER_HOME/bin/cache/dart-sdk/bin
ENV PATH=$PATH:$FLUTTER_HOME/.pub-cache/bin

RUN flutter doctor; \
    chown -R $USER:$USER $FLUTTER_HOME